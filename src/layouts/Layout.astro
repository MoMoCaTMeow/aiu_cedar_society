---
import "../styles/global.css";
import SEO from "../components/SEO.astro";
import SchemaOrganization from "../components/SchemaOrganization.astro";
import { ViewTransitions } from "astro:transitions";

interface Props {
    seo?: {
        title?: string;
        description?: string;
        keywords?: string;
        ogImage?: string;
        ogType?: "website" | "article";
        article?: {
            publishedTime?: string;
            author?: string;
        };
    };
}

const { seo = {} } = Astro.props;
---

<!doctype html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />

        <!-- Favicons -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link
            rel="icon"
            type="image/png"
            sizes="112x112"
            href="/favicon-32x32.png"
        />
        <link rel="apple-touch-icon" href="/favicon-32x32.png" />
        <link rel="manifest" href="/site.webmanifest" />

        <meta name="generator" content={Astro.generator} />

        <!-- SEO Meta Tags -->
        <SEO {...seo} />

        <!-- View Transitions for smooth page navigation -->
        <ViewTransitions />

        <!-- DNS Prefetch for faster resolution -->
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
        <link rel="dns-prefetch" href="https://images.microcms-assets.io" />

        <!-- Preconnect for critical origins -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            rel="preconnect"
            href="https://images.microcms-assets.io"
            crossorigin
        />

        <!-- 
            Google Fonts Optimization:
            - Using text= parameter to subset only needed characters (reduces 89KB to ~5KB)
            - Using font-display=swap for better FCP
            - Only loading weights actually used
        -->
        <link
            rel="preload"
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
            as="style"
            onload="this.onload=null;this.rel='stylesheet'"
        />
        <noscript>
            <link
                href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap"
                rel="stylesheet"
            />
        </noscript>

        <!-- NProgress Styles (inline for fast loading) -->
        <style>
            /* NProgress Loading Bar */
            #nprogress {
                pointer-events: none;
            }
            #nprogress .bar {
                background: #006837;
                position: fixed;
                z-index: 9999;
                top: 0;
                left: 0;
                width: 100%;
                height: 3px;
            }
            #nprogress .peg {
                display: block;
                position: absolute;
                right: 0px;
                width: 100px;
                height: 100%;
                box-shadow:
                    0 0 10px #006837,
                    0 0 5px #006837;
                opacity: 1;
                transform: rotate(3deg) translate(0px, -4px);
            }
        </style>

        <!-- Critical CSS for above-the-fold content - reduces FCP -->
        <style>
            /* System font stack as fallback for immediate rendering */
            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI",
                    "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Meiryo",
                    sans-serif;
                margin: 0;
                background-color: #f9fafb;
            }
            /* Prevent layout shift when custom font loads */
            .font-sans {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI",
                    "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Meiryo",
                    sans-serif;
            }
            /* When Noto Sans JP is loaded, apply it */
            .fonts-loaded body,
            .fonts-loaded .font-sans {
                font-family:
                    "Noto Sans JP",
                    -apple-system,
                    BlinkMacSystemFont,
                    sans-serif;
            }
            /* Critical header styles */
            header {
                position: fixed;
                width: 100%;
                top: 0;
                z-index: 50;
                background: rgba(249, 250, 251, 0.95);
                backdrop-filter: blur(12px);
            }
            /* Critical above-the-fold container */
            .container {
                max-width: 72rem;
                margin: 0 auto;
                padding: 0 1rem;
            }
        </style>

        <!-- NProgress Script (load early for page transitions) -->
        <script is:inline>
            // Import NProgress from CDN for minimal bundle impact
            (function () {
                const script = document.createElement("script");
                script.src = "https://unpkg.com/nprogress@0.2.0/nprogress.js";
                script.onload = function () {
                    if (typeof NProgress !== "undefined") {
                        NProgress.configure({
                            showSpinner: false,
                            trickleSpeed: 200,
                            minimum: 0.08,
                        });
                    }
                };
                document.head.appendChild(script);
            })();
        </script>

        <!-- Google Analytics 4 (Deferred for better performance) -->
        <script is:inline>
            // Defer GA loading until after page load
            window.addEventListener("load", function () {
                setTimeout(function () {
                    var script = document.createElement("script");
                    script.src =
                        "https://www.googletagmanager.com/gtag/js?id=G-850X7KS6F5";
                    script.async = true;
                    document.head.appendChild(script);

                    window.dataLayer = window.dataLayer || [];
                    function gtag() {
                        dataLayer.push(arguments);
                    }
                    window.gtag = gtag;
                    gtag("js", new Date());
                    gtag("config", "G-850X7KS6F5");
                }, 100);
            });

            // Font loading detection
            if ("fonts" in document) {
                document.fonts.ready.then(function () {
                    document.documentElement.classList.add("fonts-loaded");
                });
            }
        </script>
        <style is:global>
            /* ===== View Transitions API Enhancements ===== */
            /* Shared elements for smooth transitions between pages */
            h1,
            .page-title {
                view-transition-name: page-title;
            }

            .breadcrumb-nav {
                view-transition-name: breadcrumb;
            }

            /* Prevent overflow during transitions */
            ::view-transition-image-pair(*) {
                overflow: hidden;
            }

            /* Enhanced motion sensitivity support */
            @media (prefers-reduced-motion: reduce) {
                ::view-transition-group(*),
                ::view-transition-old(*),
                ::view-transition-new(*) {
                    animation: none !important;
                }
            }

            /* CSS Variables for Dark Mode */
            :root {
                /* Legacy Dark Mode Variables (保持) */
                --bg-primary: #ffffff;
                --bg-secondary: #f9fafb;
                --bg-gradient-start: #f9fafb;
                --bg-gradient-end: #ffffff;
                --text-primary: #111827;
                --text-secondary: #4b5563;
                --text-tertiary: #6b7280;
                --border-color: #e5e7eb;
                --border-color-hover: rgba(0, 104, 55, 0.3);
                --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);

                /* ===== Design Token System ===== */

                /* Primary Color Scale */
                --color-primary-50: #e6f7ef;
                --color-primary-100: #ccefdf;
                --color-primary-200: #99dfbf;
                --color-primary-300: #66cf9f;
                --color-primary-400: #33bf7f;
                --color-primary-500: #006837;
                --color-primary-600: #005028;
                --color-primary-700: #003c1e;
                --color-primary-800: #002814;
                --color-primary-900: #00140a;

                /* Gray Scale */
                --color-gray-50: #f9fafb;
                --color-gray-100: #f3f4f6;
                --color-gray-200: #e5e7eb;
                --color-gray-300: #d1d5db;
                --color-gray-400: #9ca3af;
                --color-gray-500: #6b7280;
                --color-gray-600: #4b5563;
                --color-gray-700: #374151;
                --color-gray-800: #1f2937;
                --color-gray-900: #111827;

                /* Semantic Colors */
                --color-success: #10b981;
                --color-warning: #f59e0b;
                --color-error: #ef4444;
                --color-info: #3b82f6;

                /* Typography */
                --font-sans:
                    "Noto Sans JP", -apple-system, BlinkMacSystemFont,
                    sans-serif;
                --font-mono: "SF Mono", Monaco, "Cascadia Code", monospace;

                --font-size-xs: 0.75rem;
                --font-size-sm: 0.875rem;
                --font-size-base: 1rem;
                --font-size-lg: 1.125rem;
                --font-size-xl: 1.25rem;
                --font-size-2xl: 1.5rem;
                --font-size-3xl: 1.875rem;
                --font-size-4xl: 2.25rem;
                --font-size-5xl: 3rem;
                --font-size-6xl: 3.75rem;

                --font-weight-normal: 400;
                --font-weight-medium: 500;
                --font-weight-semibold: 600;
                --font-weight-bold: 700;

                --line-height-tight: 1.25;
                --line-height-normal: 1.5;
                --line-height-relaxed: 1.75;
                --line-height-loose: 2;

                /* Spacing (4px base) */
                --space-0: 0;
                --space-1: 0.25rem;
                --space-2: 0.5rem;
                --space-3: 0.75rem;
                --space-4: 1rem;
                --space-5: 1.25rem;
                --space-6: 1.5rem;
                --space-8: 2rem;
                --space-10: 2.5rem;
                --space-12: 3rem;
                --space-16: 4rem;
                --space-20: 5rem;
                --space-24: 6rem;

                /* Transitions */
                --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
                --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
                --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);

                --ease-in: cubic-bezier(0.4, 0, 1, 1);
                --ease-out: cubic-bezier(0, 0, 0.2, 1);
                --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);

                /* Border Radius */
                --radius-sm: 0.25rem;
                --radius-md: 0.5rem;
                --radius-lg: 0.75rem;
                --radius-xl: 1rem;
                --radius-full: 9999px;

                /* Z-Index Scale */
                --z-base: 0;
                --z-dropdown: 10;
                --z-sticky: 20;
                --z-fixed: 30;
                --z-modal-backdrop: 40;
                --z-modal: 50;
                --z-popover: 60;
                --z-tooltip: 70;
            }

            [data-theme="dark"] {
                --bg-primary: #1c1c1e; /* macOS dark card */
                --bg-secondary: #000000; /* macOS black background */
                --bg-gradient-start: #000000;
                --bg-gradient-end: #1c1c1e;
                --text-primary: #ffffff; /* Pure white */
                --text-secondary: #ebebf5; /* macOS secondary label */
                --text-tertiary: #ebebf599; /* macOS tertiary label */
                --border-color: #38383a; /* macOS separator */
                --border-color-hover: rgba(50, 215, 75, 0.4); /* macOS green */
                --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
                --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
                --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
                --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6);
            }

            html {
                scroll-behavior: smooth;
                background-color: var(--bg-primary);
                transition: background-color 0.3s ease;
            }

            body {
                background-color: var(--bg-primary);
                color: var(--text-primary);
                transition:
                    background-color 0.3s ease,
                    color 0.3s ease;
            }

            /* Comprehensive Dark Mode Styles - macOS Inspired */

            /* Background Colors - Natural, softer tones */
            [data-theme="dark"] .bg-white {
                background-color: #1c1c1e !important; /* macOS dark card background */
            }

            [data-theme="dark"] .bg-gray-50 {
                background-color: #000000 !important; /* macOS true black background */
            }

            [data-theme="dark"] .bg-gray-100 {
                background-color: #2c2c2e !important; /* macOS secondary background */
            }

            [data-theme="dark"] .bg-gradient-to-b {
                background-image: linear-gradient(
                    to bottom,
                    #000000,
                    #1c1c1e
                ) !important;
            }

            /* Accent color - slightly muted for dark mode */
            [data-theme="dark"] .bg-\[\#006837\] {
                background-color: #34c759 !important; /* macOS system green */
            }

            /* Text Colors - Natural contrast */
            [data-theme="dark"] .text-gray-900,
            [data-theme="dark"] .text-gray-800,
            [data-theme="dark"] .text-gray-700 {
                color: #ffffff !important; /* Pure white for primary text */
            }

            [data-theme="dark"] .text-gray-600 {
                color: #ebebf5 !important; /* macOS secondary label */
            }

            [data-theme="dark"] .text-gray-500 {
                color: #ebebf599 !important; /* macOS tertiary label - 60% opacity */
            }

            [data-theme="dark"] .text-gray-400 {
                color: #ebebf54d !important; /* macOS quaternary label - 30% opacity */
            }

            [data-theme="dark"] .text-gray-300 {
                color: #ebebf533 !important; /* Subtle text - 20% opacity */
            }

            /* Accent text colors */
            [data-theme="dark"] .text-\[\#006837\] {
                color: #32d74b !important; /* macOS system green (lighter) */
            }

            [data-theme="dark"] .hover\:text-\[\#006837\]:hover {
                color: #30d158 !important;
            }

            /* Links - Natural appearance */
            [data-theme="dark"]
                a:not(.bg-\[\#006837\]):not(.bg-black):not(.bg-gradient-to-r) {
                color: #ebebf5;
            }

            [data-theme="dark"] a:hover {
                color: #32d74b; /* macOS green on hover */
            }

            /* Borders - Subtle separators */
            [data-theme="dark"] .border-gray-200,
            [data-theme="dark"] .border-gray-100 {
                border-color: #38383a !important; /* macOS separator */
            }

            [data-theme="dark"] .border-t,
            [data-theme="dark"] .border-b,
            [data-theme="dark"] .border-l {
                border-color: #38383a !important;
            }

            [data-theme="dark"] .border-\[\#006837\] {
                border-color: #32d74b !important;
            }

            /* Shadows - Softer, more natural */
            [data-theme="dark"] .shadow-sm {
                box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3) !important;
            }

            [data-theme="dark"] .shadow-md {
                box-shadow:
                    0 4px 6px -1px rgba(0, 0, 0, 0.4),
                    0 2px 4px -1px rgba(0, 0, 0, 0.3) !important;
            }

            [data-theme="dark"] .shadow-lg {
                box-shadow:
                    0 10px 15px -3px rgba(0, 0, 0, 0.5),
                    0 4px 6px -2px rgba(0, 0, 0, 0.3) !important;
            }

            [data-theme="dark"] .shadow-xl {
                box-shadow:
                    0 20px 25px -5px rgba(0, 0, 0, 0.6),
                    0 10px 10px -5px rgba(0, 0, 0, 0.4) !important;
            }

            /* Header - Fixed backdrop blur issue */
            [data-theme="dark"] header {
                background-color: rgba(
                    28,
                    28,
                    30,
                    0.8
                ) !important; /* Semi-transparent dark */
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                border-bottom-color: #38383a !important;
            }

            /* Footer */
            [data-theme="dark"] footer {
                background-color: #1c1c1e !important;
                border-top-color: #38383a !important;
            }

            /* Hover States - Subtle */
            [data-theme="dark"] .hover\:bg-gray-50:hover {
                background-color: #2c2c2e !important;
            }

            /* Dropdown Menus */
            [data-theme="dark"] .dropdown-menu {
                background-color: rgba(44, 44, 46, 0.95) !important;
                backdrop-filter: blur(20px) saturate(180%);
                -webkit-backdrop-filter: blur(20px) saturate(180%);
                border-color: #38383a !important;
            }

            /* Font Display Optimization */
            @font-face {
                font-family: "Noto Sans JP";
                font-display: swap;
            }

            /* CSS Containment for Performance */
            .lecture-card,
            .event-card {
                contain: layout style paint;
            }

            .container {
                contain: layout;
            }

            /* Enhanced Focus for WCAG 2.2 Compliance */
            a:focus-visible,
            button:focus-visible,
            input:focus-visible,
            textarea:focus-visible,
            select:focus-visible {
                outline: 3px solid #006837;
                outline-offset: 3px;
                border-radius: 4px;
                position: relative;
                z-index: 100; /* Ensure focus is not obscured */
                transition: outline-offset 0.2s ease;
            }

            /* Focus Appearance - Enhanced contrast */
            [data-theme="dark"] a:focus-visible,
            [data-theme="dark"] button:focus-visible,
            [data-theme="dark"] input:focus-visible,
            [data-theme="dark"] textarea:focus-visible,
            [data-theme="dark"] select:focus-visible {
                outline-color: #32d74b;
            }

            /* Remove outline for mouse users */
            a:focus:not(:focus-visible),
            button:focus:not(:focus-visible) {
                outline: none;
            }

            /* Touch Target Size Optimization - WCAG 2.2 */
            button,
            a,
            input[type="submit"],
            input[type="button"] {
                min-height: 44px;
                min-width: 44px;
            }

            /* Skeleton Loading Animation */
            @keyframes skeleton-loading {
                0% {
                    background-position: -200px 0;
                }
                100% {
                    background-position: calc(200px + 100%) 0;
                }
            }

            .skeleton {
                background-color: #e0e0e0;
                background-image: linear-gradient(
                    90deg,
                    #e0e0e0 0px,
                    #f0f0f0 40px,
                    #e0e0e0 80px
                );
                background-size: 200px 100%;
                background-repeat: no-repeat;
                animation: skeleton-loading 1.2s ease-in-out infinite;
            }

            [data-theme="dark"] .skeleton {
                background-color: #374151;
                background-image: linear-gradient(
                    90deg,
                    #374151 0px,
                    #4b5563 40px,
                    #374151 80px
                );
            }

            .skeleton-text {
                height: 1rem;
                margin-bottom: 0.5rem;
                border-radius: 0.25rem;
            }

            .skeleton-text.short {
                width: 60%;
            }

            .skeleton-image {
                width: 100%;
                aspect-ratio: 3/4;
                border-radius: 0.5rem 0.5rem 0 0;
            }

            /* Toast Notifications */
            .toast-container {
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 10000;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }

            .toast {
                min-width: 300px;
                max-width: 400px;
                padding: 16px 20px;
                border-radius: 8px;
                background: white;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                display: flex;
                align-items: center;
                gap: 12px;
                transform: translateX(400px);
                opacity: 0;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .toast.show {
                transform: translateX(0);
                opacity: 1;
            }

            .toast-success {
                border-left: 4px solid #10b981;
            }

            .toast-error {
                border-left: 4px solid #ef4444;
            }

            .toast-info {
                border-left: 4px solid #3b82f6;
            }

            .toast-icon {
                flex-shrink: 0;
                width: 20px;
                height: 20px;
            }

            .toast-message {
                flex: 1;
                font-size: 14px;
                line-height: 1.5;
                color: #1f2937;
            }

            [data-theme="dark"] .toast {
                background: #1f2937;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            }
            [data-theme="dark"] .toast-message {
                color: #f9fafb;
            }

            /* Feedback Button Animation */
            @keyframes pulse-slow {
                0%,
                100% {
                    opacity: 1;
                }
                50% {
                    opacity: 0.85;
                }
            }

            .animate-pulse-slow {
                animation: pulse-slow 3s ease-in-out infinite;
            }

            #feedback-button:hover {
                animation: none;
            }

            ::selection {
                background-color: #006837;
                color: white;
            }

            /* Micro-interactions */

            /* Ripple Effect for Buttons */
            @keyframes ripple {
                0% {
                    transform: scale(0);
                    opacity: 0.6;
                }
                100% {
                    transform: scale(2.5);
                    opacity: 0;
                }
            }

            .ripple-effect {
                position: relative;
                overflow: hidden;
            }

            .ripple-effect::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 20px;
                height: 20px;
                background: rgba(255, 255, 255, 0.5);
                border-radius: 50%;
                transform: translate(-50%, -50%) scale(0);
                pointer-events: none;
            }

            .ripple-effect:active::after {
                animation: ripple 0.6s ease-out;
            }

            /* 3D Tilt Effect for Cards with Enhanced Depth */
            .card-tilt {
                transition:
                    transform 0.3s ease,
                    box-shadow 0.3s ease;
                transform-style: preserve-3d;
                box-shadow:
                    0 4px 20px -8px rgba(0, 104, 55, 0.08),
                    0 0 0 1px rgba(0, 0, 0, 0.04);
            }

            @media (hover: hover) {
                .card-tilt:hover {
                    transform: perspective(1000px) rotateY(2deg) rotateX(-2deg)
                        scale(1.01);
                    box-shadow:
                        0 12px 40px -10px rgba(0, 104, 55, 0.15),
                        0 0 0 1px rgba(0, 104, 55, 0.08);
                }
            }

            /* Smooth hover transitions */
            .smooth-hover {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            /* Will-change for performance optimization */
            .card-tilt,
            .smooth-hover {
                will-change: transform;
            }

            /* ===== CSS content-visibility for Performance ===== */
            /* Dramatically improves rendering speed by skipping off-screen content */

            .content-visibility-auto {
                content-visibility: auto;
                contain-intrinsic-size: 0 400px;
            }

            /* Member cards optimization */
            .member-card {
                content-visibility: auto;
                contain-intrinsic-size: 0 350px;
            }

            /* Lecture cards optimization */
            .lecture-card {
                content-visibility: auto;
                contain-intrinsic-size: 0 300px;
            }

            /* Shimmer loading effect for perceived performance */
            @keyframes shimmer {
                0% {
                    background-position: -1000px 0;
                }
                100% {
                    background-position: 1000px 0;
                }
            }

            .skeleton {
                background: linear-gradient(
                    90deg,
                    #f0f0f0 25%,
                    #e0e0e0 50%,
                    #f0f0f0 75%
                );
                background-size: 1000px 100%;
                animation: shimmer 2s infinite linear;
                border-radius: 4px;
            }

            [data-theme="dark"] .skeleton {
                background: linear-gradient(
                    90deg,
                    #2a2a2a 25%,
                    #1a1a1a 50%,
                    #2a2a2a 75%
                );
                background-size: 1000px 100%;
            }

            img.loading {
                background: linear-gradient(
                    90deg,
                    #f0f0f0 25%,
                    #e0e0e0 50%,
                    #f0f0f0 75%
                );
                background-size: 1000px 100%;
                animation: shimmer 2s infinite;
            }

            /* ===== Micro-interactions Enhancement ===== */
            /* Button feedback - subtle scale on click */
            button,
            .btn,
            a.button {
                transition:
                    transform var(--transition-fast),
                    box-shadow var(--transition-fast),
                    background-color var(--transition-fast);
            }

            button:active,
            .btn:active,
            a.button:active {
                transform: scale(0.98);
            }

            /* Enhanced link hover with underline animation */
            a:not(.button):not(.btn) {
                position: relative;
                transition: color var(--transition-fast);
            }

            a:not(.button):not(.btn)::after {
                content: "";
                position: absolute;
                width: 0;
                height: 2px;
                bottom: -2px;
                left: 0;
                background-color: currentColor;
                transition: width var(--transition-base);
            }

            a:not(.button):not(.btn):hover::after {
                width: 100%;
            }

            /* Smooth page scroll */
            html {
                scroll-behavior: smooth;
            }

            @media (prefers-reduced-motion: reduce) {
                html {
                    scroll-behavior: auto;
                }

                button,
                .btn,
                a {
                    transition: none !important;
                }

                a::after {
                    transition: none !important;
                }
            }
            /* Remove will-change after interaction */
            @media (prefers-reduced-motion: reduce) {
                .card-tilt,
                .smooth-hover {
                    will-change: auto;
                    transition: none;
                }
            }
        </style>

        <!-- Structured Data -->
        <SchemaOrganization />
    </head>
    <body
        class="bg-gray-50 text-[#333333] font-sans antialiased min-h-screen flex flex-col tracking-wide font-normal selection:bg-[#006837] selection:text-white relative"
    >
        <header
            class="py-4 md:py-8 px-4 md:px-6 lg:px-12 fixed w-full top-0 z-50 transition-all duration-300 bg-gray-50/95 backdrop-blur-md border-b border-gray-200/50"
        >
            <div
                class="container mx-auto max-w-6xl flex justify-between items-center"
            >
                <a
                    href="/"
                    class="text-base md:text-lg font-bold tracking-wide text-gray-900 hover:text-[#006837] transition-colors min-h-[44px] flex items-center"
                >
                    AIU Cedar Society
                </a>
                <nav class="flex items-center gap-2 md:gap-4">
                    {/* About Dropdown */}
                    <div class="relative dropdown-container">
                        <button
                            class="dropdown-button text-xs md:text-sm font-medium text-gray-600 hover:text-[#006837] transition-colors tracking-wider min-h-[44px] flex items-center px-2 md:px-3 gap-1"
                        >
                            ABOUT
                            <svg
                                class="dropdown-icon w-3 h-3 transition-transform"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div
                            class="dropdown-menu absolute left-0 mt-0 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible transition-all duration-200 z-50"
                        >
                            <a
                                href="/about"
                                class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#006837] transition-colors border-b border-gray-100"
                                >私たちについて</a
                            >
                            <a
                                href="/about/history"
                                class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#006837] transition-colors border-b border-gray-100"
                                >設立の経緯</a
                            >
                            <a
                                href="/about/members"
                                class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#006837] transition-colors rounded-b-lg"
                                >メンバー紹介</a
                            >
                        </div>
                    </div>

                    {/* Events Dropdown */}
                    <div class="relative dropdown-container">
                        <button
                            class="dropdown-button text-xs md:text-sm font-medium text-gray-600 hover:text-[#006837] transition-colors tracking-wider min-h-[44px] flex items-center px-2 md:px-3 gap-1"
                        >
                            EVENTS
                            <svg
                                class="dropdown-icon w-3 h-3 transition-transform"
                                fill="none"
                                viewBox="0 0 24 24"
                                stroke="currentColor"
                            >
                                <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    stroke-width="2"
                                    d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div
                            class="dropdown-menu absolute left-0 mt-0 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible transition-all duration-200 z-50"
                        >
                            <a
                                href="/events/upcoming"
                                class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#006837] transition-colors border-b border-gray-100 rounded-t-lg"
                                >今後の予定</a
                            >
                            <a
                                href="/events/past"
                                class="block px-4 py-3 text-sm text-gray-700 hover:bg-gray-50 hover:text-[#006837] transition-colors rounded-b-lg"
                                >過去の講演会</a
                            >
                        </div>
                    </div>

                    {/* Media Link */}
                    <a
                        href="/media"
                        class="text-xs md:text-sm font-medium text-gray-600 hover:text-[#006837] transition-colors tracking-wider min-h-[44px] flex items-center px-2 md:px-3"
                        >MEDIA</a
                    >

                    {/* Contact Link */}
                    <a
                        href="/contact"
                        class="text-xs md:text-sm font-medium text-gray-600 hover:text-[#006837] transition-colors tracking-wider min-h-[44px] flex items-center px-2 md:px-3"
                        >CONTACT</a
                    >

                    {/* Dark Mode Toggle */}
                    <button
                        id="theme-toggle"
                        class="text-xs md:text-sm font-medium text-gray-600 hover:text-[#006837] transition-colors tracking-wider min-h-[44px] flex items-center px-2 md:px-3"
                        aria-label="ダークモード切替"
                    >
                        <svg
                            id="theme-toggle-light-icon"
                            class="w-5 h-5"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                        >
                            <path
                                d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
                            ></path>
                        </svg>
                        <svg
                            id="theme-toggle-dark-icon"
                            class="w-5 h-5 hidden"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                        >
                            <path
                                d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                                fill-rule="evenodd"
                                clip-rule="evenodd"></path>
                        </svg>
                    </button>
                </nav>
            </div>
        </header>

        <!-- Feedback Button (Staging) -->
        <a
            href="https://forms.gle/pst2kQJxtYF4eTND8"
            target="_blank"
            rel="noopener noreferrer"
            id="feedback-button"
            class="fixed bottom-24 right-6 bg-white dark:bg-gray-800 text-[#006837] dark:text-green-400 border-2 border-[#006837] dark:border-green-400 rounded-full shadow-lg hover:shadow-xl hover:bg-[#006837] hover:text-white dark:hover:bg-green-400 dark:hover:text-gray-900 transition-all duration-300 z-50 flex items-center gap-3 px-5 py-3 hover:scale-105 group"
            aria-label="フィードバックを送る"
        >
            <svg
                class="w-5 h-5 group-hover:rotate-12 transition-transform"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
                ></path>
            </svg>
            <span class="font-bold text-sm whitespace-nowrap"
                >フィードバック</span
            >
        </a>

        <!-- Back to Top Button -->
        <a
            href="#top"
            id="back-to-top"
            class="fixed bottom-6 right-6 w-12 h-12 bg-[#006837] text-white rounded-full flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-[#005028] shadow-lg hover:shadow-xl z-50"
            aria-label="トップに戻る"
        >
            <svg
                class="w-5 h-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2.5"
                    d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
            </svg>
        </a>

        <main class="flex-grow pt-24" id="top">
            <slot />
        </main>
        <footer
            class="py-12 px-6 border-t border-gray-200 bg-gray-50 relative z-10"
        >
            <div class="container mx-auto max-w-6xl">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                    <div>
                        <p class="text-gray-900 font-bold text-lg mb-4">
                            AIU Cedar Society
                        </p>
                        <p
                            class="text-sm text-gray-600 leading-relaxed max-w-md"
                        >
                            秋田国際教養大学の学生主導の公認団体。著名なゲストを招いた講演会を通じて、学生と秋田社会をつなぎます。
                        </p>
                    </div>

                    {/* Instagram Section */}
                    <div>
                        <p class="text-gray-900 font-semibold mb-4">
                            公式Instagram
                        </p>
                        <p class="text-sm text-gray-600 mb-4 leading-relaxed">
                            最新情報や講演会の様子を発信中！<br
                            />ぜひフォローしてください。
                        </p>
                        <a
                            href="https://www.instagram.com/aiucedarsociety"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex items-center gap-2 px-4 py-2 bg-gray-800 dark:bg-gray-700 text-white rounded-lg hover:bg-gray-900 dark:hover:bg-gray-600 transition-colors duration-300 font-medium"
                        >
                            <svg
                                class="w-5 h-5"
                                fill="currentColor"
                                viewBox="0 0 24 24"
                            >
                                <path
                                    d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"
                                ></path>
                            </svg>
                            <span>@aiucedarsociety</span>
                        </a>
                    </div>

                    {/* Links */}
                    <div>
                        <p class="text-gray-900 font-semibold mb-4">リンク</p>
                        <div class="space-y-2">
                            <a
                                href="/about"
                                class="block text-sm text-gray-600 hover:text-[#006837] transition-colors"
                                >団体について</a
                            >
                            <a
                                href="/events/upcoming"
                                class="block text-sm text-gray-600 hover:text-[#006837] transition-colors"
                                >今後の予定</a
                            >
                            <a
                                href="/contact"
                                class="block text-sm text-gray-600 hover:text-[#006837] transition-colors"
                                >お問い合わせ</a
                            >
                        </div>
                    </div>
                </div>

                <div class="text-center pt-6 border-t border-gray-200">
                    <p class="text-xs text-gray-500 tracking-widest">
                        &copy; {new Date().getFullYear()} AIU Cedar Society. All rights
                        reserved.
                    </p>
                </div>
            </div>
        </footer>

        <!-- Performance Optimization Scripts -->
        <script>
            import { setupLazyLoading } from "../utils/lazyLoad";
            import { measureWebVitals } from "../utils/webVitals";

            // Initialize on page load (View Transitions compatible)
            document.addEventListener("astro:page-load", () => {
                setupLazyLoading();
                measureWebVitals();
            });
        </script>
    </body>
</html>

<style>
    :root {
        --font-sans: "Noto Sans JP", sans-serif;
        --color-aiu-green: #006837;
    }
    html {
        font-family: var(--font-sans);
    }

    /* Desktop hover support */
    @media (hover: hover) {
        .dropdown-container:hover .dropdown-menu {
            opacity: 1;
            visibility: visible;
        }
        .dropdown-container:hover .dropdown-icon {
            transform: rotate(180deg);
        }
    }

    /* Active dropdown state */
    .dropdown-container.active .dropdown-menu {
        opacity: 1;
        visibility: visible;
    }
    .dropdown-container.active .dropdown-icon {
        transform: rotate(180deg);
    }
</style>

<script is:inline>
    // Dark Mode Toggle with localStorage (View Transitions Compatible)
    function initThemeToggle() {
        const themeToggle = document.getElementById("theme-toggle");
        const lightIcon = document.getElementById("theme-toggle-light-icon");
        const darkIcon = document.getElementById("theme-toggle-dark-icon");
        const html = document.documentElement;

        // Check for saved theme preference or default to light mode
        const currentTheme = localStorage.getItem("theme") || "light";

        // Apply theme on load
        if (currentTheme === "dark") {
            html.setAttribute("data-theme", "dark");
            lightIcon?.classList.add("hidden");
            darkIcon?.classList.remove("hidden");
        } else {
            html.setAttribute("data-theme", "light");
            lightIcon?.classList.remove("hidden");
            darkIcon?.classList.add("hidden");
        }

        // Remove existing listener to prevent duplicates
        if (themeToggle) {
            themeToggle.replaceWith(themeToggle.cloneNode(true));
            const newToggle = document.getElementById("theme-toggle");

            // Toggle theme
            newToggle?.addEventListener("click", function () {
                const theme = html.getAttribute("data-theme");

                if (theme === "dark") {
                    html.setAttribute("data-theme", "light");
                    localStorage.setItem("theme", "light");
                    lightIcon?.classList.remove("hidden");
                    darkIcon?.classList.add("hidden");
                } else {
                    html.setAttribute("data-theme", "dark");
                    localStorage.setItem("theme", "dark");
                    lightIcon?.classList.add("hidden");
                    darkIcon?.classList.remove("hidden");
                }
            });
        }
    }

    // Initialize on first page load
    initThemeToggle();

    // Re-initialize after View Transitions page swap
    document.addEventListener("astro:page-load", initThemeToggle);

    // Dropdown Menu Functionality
    document.addEventListener("DOMContentLoaded", function () {
        const dropdownContainers = document.querySelectorAll(
            ".dropdown-container",
        );

        dropdownContainers.forEach((container) => {
            const button = container.querySelector(".dropdown-button");
            const menu = container.querySelector(".dropdown-menu");

            // Toggle dropdown on button click (for mobile and desktop)
            button.addEventListener("click", function (e) {
                e.stopPropagation();

                // Close all other dropdowns
                dropdownContainers.forEach((otherContainer) => {
                    if (otherContainer !== container) {
                        otherContainer.classList.remove("active");
                    }
                });

                // Toggle current dropdown
                container.classList.toggle("active");
            });

            // Prevent dropdown from closing when clicking inside menu
            menu.addEventListener("click", function (e) {
                e.stopPropagation();
            });
        });

        // Close dropdowns when clicking outside
        document.addEventListener("click", function () {
            dropdownContainers.forEach((container) => {
                container.classList.remove("active");
            });
        });

        // Close dropdowns on navigation (when clicking a link inside dropdown)
        document.querySelectorAll(".dropdown-menu a").forEach((link) => {
            link.addEventListener("click", function () {
                dropdownContainers.forEach((container) => {
                    container.classList.remove("active");
                });
            });
        });
    });

    // Toast Notification System
    window.showToast = function (message, type = "success") {
        const container = document.getElementById("toast-container");
        if (!container) return;

        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.setAttribute("role", "alert");
        toast.setAttribute("aria-live", "polite");

        const icons = {
            success: "✓",
            error: "✕",
            info: "ℹ",
        };

        toast.innerHTML = `
            <div class="toast-icon" style="color: ${type === "success" ? "#10b981" : type === "error" ? "#ef4444" : "#3b82f6"}; font-size: 18px; font-weight: bold;">
                ${icons[type] || icons.info}
            </div>
            <div class="toast-message">${message}</div>
        `;

        container.appendChild(toast);

        setTimeout(() => {
            toast.classList.add("show");
        }, 100);

        setTimeout(() => {
            toast.classList.remove("show");
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    };

    // View Transitions API with NProgress Integration
    document.addEventListener("astro:before-preparation", () => {
        if (typeof NProgress !== "undefined") {
            NProgress.start();
        }
    });

    document.addEventListener("astro:after-swap", () => {
        if (typeof NProgress !== "undefined") {
            NProgress.done();
        }
    });

    document.addEventListener("astro:page-load", () => {
        if (typeof NProgress !== "undefined") {
            NProgress.done();
        }
    });

    // Back to Top Button Handler
    window.addEventListener(
        "scroll",
        function () {
            const backToTopBtn = document.getElementById("back-to-top");
            if (window.scrollY > 300) {
                backToTopBtn.classList.remove("opacity-0", "invisible");
                backToTopBtn.classList.add("opacity-100", "visible");
            } else {
                backToTopBtn.classList.add("opacity-0", "invisible");
                backToTopBtn.classList.remove("opacity-100", "visible");
            }
        },
        { passive: true },
    );
</script>
